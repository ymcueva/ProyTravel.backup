<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="paqueteturistico">
	
	<typeAlias alias="paqueteTuristicoBean" type="pe.com.paxtravel.bean.PaqueteTuristicoBean" />
	<typeAlias alias="string" type="java.lang.String" />

	<resultMap id="resultPaqueteTuristico" class="paqueteTuristicoBean">		
		<result property="numeroFila"			    column="ca_nume_fila" />		
		<result property="idPaquete"			    column="id_paquete" />			
		<result property="nombre" 		    column="nombre" />
		<result property="idEstado" 	column="id_estado" />
		<result property="observacion" 				column="observacion" />
		<result property="idOrden"			    column="id_orden" />
		<result property="fecha" 		    column="fecha" />
		<result property="fechaIni" 		    column="fe_inicio" />
		<result property="fechaFin" 		    column="fe_fin" />
		<result property="idTrabajador"			    column="id_trabajador" />		
		<result property="nombreEstadoPaquete" 	column="no_estado" />
		<result property="nuOrden" 	column="nu_orden" />		
<!-- 		<result property="nuNinos"			    column="nu_ninos" /> -->
<!-- 		<result property="nuAdultos"			    column="nu_adultos" /> -->
<!-- 		<result property="nuDias"			    column="nu_dias" /> -->
<!-- 		<result property="fePartida"			    column="fe_partida" /> -->
<!-- 		<result property="feRetorno"			    column="fe_retorno" />		 -->
		
		<result property="nombreCliente" 		    column="cliente" />
		
		<result property="nuOrden" 		    column="nu_orden" />
		<result property="autorizacion" 		    column="autorizacion" />
		<result property="imPresupuestoMinimo" 		    column="im_presupuesto_minimo" />
		<result property="imPresupuestoMaximo" 		    column="im_presupuesto_maximo" />
		<result property="observacion" 		    column="observacion" />		
						
	</resultMap>
	
	<select id="listarPaqueteTuristico" parameterClass="paqueteTuristicoBean" resultMap="resultPaqueteTuristico">
		
		SELECT 
						
			   @rownum:=@rownum+1 AS ca_nume_fila,  
			   
			   paquete.id_paquete ,  
			   paquete.nombre , 
			   paquete.id_estado , 
			   paquete.observacion ,  
			   paquete.id_orden , 
			   
			   DATE_FORMAT(paquete.fecha,'%d-%m-%Y') fecha,
			   DATE_FORMAT(paquete.fe_inicio,'%d-%m-%Y') fe_inicio,
			   DATE_FORMAT(paquete.fe_fin,'%d-%m-%Y') fe_fin,			   
			   
			   paquete.id_trabajador,
			   
			   esta.no_estado, 
				
				CONCAT(clie.nombres,' ',clie.apellidos) cliente, 
							   
			    orden.nu_orden,
			   
			    orden.autorizacion,
			    orden.im_presupuesto_minimo,
			    orden.im_presupuesto_maximo, 
			    orden.observacion
			    
                              
         FROM (SELECT @rownum:=0) r, paquete_turistico paquete  
         INNER JOIN orden_planificacion orden ON orden.id_orden=paquete.id_orden
         INNER JOIN cliente clie ON orden.id_cliente=clie.id_cliente      
         INNER JOIN estado esta  ON paquete.id_estado=esta.id_estado  
		 WHERE 1 = 1
		 
	     <!-- <isNotEmpty prepend="AND" property="fecha"> DATE_FORMAT(paquete.fecha,'%Y-%m-%d')  = #fecha# </isNotEmpty>
	     <isNotEmpty prepend="AND" property="nuOrden"> orden.nu_orden = #nuOrden# </isNotEmpty> 
	     <isNotEmpty prepend="AND" property="idEstado"> paquete.id_estado = #idEstado# </isNotEmpty>  -->
	      
<!-- 	      <isNotEmpty prepend="AND" property="materno"> emp_apemat = #materno# </isNotEmpty> -->
<!-- 	      <isNotEmpty prepend="AND" property="dni"> emp_dni = #dni# </isNotEmpty> -->
<!-- 	      <isNotEmpty prepend="AND" property="fechaNacimiento"> DATE_FORMAT(emp_fec_nac,'%d/%m/%Y') = #fechaNacimiento# </isNotEmpty> -->
<!-- 	      <isNotEmpty prepend="AND" property="tipoUsuario"> emp_id_tipo_usua = #tipoUsuario# </isNotEmpty> -->
<!-- 	      <isNotEmpty prepend="AND" property="codigo"> emp_id = #codigo# </isNotEmpty> -->
	</select>
	
<!-- 	<select id="obtenerCodigoEmpleado" resultClass="string"> -->
<!-- 		SELECT LPAD(MAX(emp_id)+1,4,0) AS codigoEmpleado FROM empleado -->
<!-- 	</select> -->
	
<!-- 	<insert id="insertarEmpleado" parameterClass="empleadoBean"> -->
<!-- 		INSERT INTO empleado( -->
<!-- 			emp_id, -->
<!-- 			emp_username, -->
<!-- 			emp_apepat, -->
<!-- 			emp_apemat, -->
<!-- 			emp_nom, -->
<!-- 			emp_pass, -->
<!-- 			emp_last_ip, -->
<!-- 			emp_fec_nac, -->
<!-- 			emp_on_line, -->
<!-- 			emp_state, -->
<!-- 			emp_dni,  -->
<!-- 			emp_id_tipo_usua -->
<!-- 		) VALUES ( -->
<!-- 			#codigo#, -->
<!-- 			#username#, -->
<!-- 			#paterno#, -->
<!-- 			#materno#, -->
<!-- 			#nombre#, -->
<!-- 			#password#, -->
<!-- 			#direccionIP#, -->
<!-- 			#fechaNacimiento#, -->
<!-- 			#estadoOnLine#, -->
<!-- 			#estado#, -->
<!-- 			#dni#, -->
<!-- 			#tipoUsuario# -->
<!-- 		) -->
<!-- 	</insert> -->	
	
</sqlMap>